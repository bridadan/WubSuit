#include <inttypes.h>
#include <stdio.h>
#include "drivers/CoreUARTapb/core_uart_apb.h"
#include "drivers/mss_gpio/mss_gpio.h"

#define BAUD_VALUE_115200    53 //Possibly a problem because not exactly 53 (53.2535)
#define COREUARTAPB0_BASE_ADDR      0x40050000

uint32_t * P_WDG_ENABLE = (uint32_t *)(0x40006010);
UART_instance_t XBee_uart;

__attribute__ ((interrupt)) void GPIO0_IRQHandler( void )
{
    printf("Interrupt occurred - GPIO 0 \n\r");
    MSS_GPIO_clear_irq( MSS_GPIO_0 );
    NVIC_ClearPendingIRQ( GPIO0_IRQn );
}

int main()
{
	printf("Starting...\n\r");
	/* Disable Watchdog Timer*/
	*P_WDG_ENABLE = 0x4C6E55FA;

	// Initialize GPIO
	MSS_GPIO_init();
	MSS_GPIO_config( MSS_GPIO_0, MSS_GPIO_INPUT_MODE | MSS_GPIO_IRQ_EDGE_POSITIVE );
	MSS_GPIO_enable_irq( MSS_GPIO_0 );
	NVIC_EnableIRQ(GPIO0_IRQn);

	// Initialize UART
	UART_init(&XBee_uart, COREUARTAPB0_BASE_ADDR, BAUD_VALUE_115200, (DATA_8_BITS | NO_PARITY));

	printf("**0** Sending UART\n\r");
	uint8_t data[1] = { 0x69 };
	UART_send(&XBee_uart, data, 1);
	printf("**0** UART sent\n\r");
	while (1) {
		// wait
	}

	return 0;
}
